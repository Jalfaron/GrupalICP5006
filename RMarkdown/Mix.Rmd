---
title: "Mix"
author: "Bernardino Araya"
date: "2025-11-25"
output: html_document
---


# *Paquetes de Library*

```{r}
library(tidyverse)
library(readxl)
```



# *Dividir senadores y diputados*

```{r}
# 1. Cargar el Boletín (Asegúrate de poner el nombre correcto del archivo xls o csv)
boletin_raw <- read_excel("Bases de datos/Boletin_Unico_SD_2021.xls")


# 2. Pre-procesamiento general (limpieza básica de nombres)
boletin_clean <- boletin_raw |>
  rename(
    lista = letra,          # Equivalente en tu base limpia
    nro_voto = voto,        # Equivalente en tu base limpia
    candidato = `candidato(a)` # Quitamos el parentesis
  ) |>
  mutate(nro_voto = as.numeric(nro_voto))


# 3. Crear s_sen (Base de Senadores del Boletín)
s_sen <- boletin_clean |>
  filter(elección == "SENADOR") |>
  rename(circ_sen = territorio) |>  
  select(
    regionid, 
    región, 
    circ_sen, 
    lista,
    nro_voto,  
    pacto, 
    partido, 
    candidato, 
    sexo
  )


# 4. Crear s_dip (Base de Diputados del Boletín)
s_dip <- boletin_clean %>%
  filter(elección == "DIPUTADO") %>%
  rename(distrito = territorio) %>% # En diputados, territorio es el distrito
  select(
    regionid, 
    región, 
    distrito, 
    lista,
    nro_voto, 
    pacto, 
    partido, 
    candidato, 
    sexo
  )

# 5. Verificación rápida
print("Encabezados s_sen:")
print(names(s_sen))
print("Encabezados s_dip:")
print(names(s_dip))
```

# *Mix*


```{r}
library(tidyverse)

# ==============================================================================
# PASO 1: Estandarizar nombres en las bases del Boletín (s_sen y s_dip)
# ==============================================================================
# Renombramos 'región' a 'region' (sin tilde) para facilitar el cruce
# y nos aseguramos de que nro_voto sea numérico.

s_sen_ready <- s_sen %>%
  rename(region = región) %>% # Quitamos tilde para estándar
  mutate(nro_voto = as.numeric(nro_voto))

s_dip_ready <- s_dip %>%
  rename(region = región) %>% 
  mutate(nro_voto = as.numeric(nro_voto))

# ==============================================================================
# PASO 2: Realizar el Cruce (Left Join)
# ==============================================================================

# --- SENADORES ---
candidatos_senador <- senadores %>%
  # Unimos usando DOS llaves: que coincida la región Y el número de voto
  left_join(s_sen_ready, by = c("region", "nro_voto")) %>%
  select(
    region,                  # Usamos la columna llave
    circ_sen = circ_sen.x,   # Mantenemos datos originales
    lista = lista.x,
    pacto = pacto.x,
    partido = partido.x,
    nro_voto,                # Usamos la columna llave
    candidato = candidato.x, # Mantenemos nombre original
    sexo,                    # Columna nueva traída del boletín
    total_region,
    cargo
  )

# --- DIPUTADOS ---
candidatos_diputado <- diputados %>%
  left_join(s_dip_ready, by = c("region", "nro_voto")) %>%
  select(
    region,
    distrito = distrito.x,
    lista = lista.x,
    pacto = pacto.x,
    partido = partido.x,
    nro_voto,
    candidato = candidato.x,
    sexo,                    # Columna nueva
    total_region,
    cargo
  )

# ==============================================================================
# PASO 3: Verificación de Integridad
# ==============================================================================
# Chequeamos cuántos candidatos NO encontraron match (sexo NA)
print("Senadores sin match de sexo:")
print(sum(is.na(candidatos_senador$sexo)))

print("Diputados sin match de sexo:")
print(sum(is.na(candidatos_diputado$sexo)))

```
